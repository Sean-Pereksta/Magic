<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ”‘ Create Account</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f9fafb;
      --ink:#111827;
      --muted:#6b7280;
      --card:#ffffff;
      --br:#e5e7eb;
      --accent:#b91c1c;
      --accent-soft:#fee2e2;
      --good:#16a34a;
      --bad:#dc2626;
      --radius:18px;
      --shadow:0 18px 40px rgba(15,23,42,.18);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 0% -200px, rgba(248,113,113,.18) 0%, transparent 55%),
        radial-gradient(1200px 600px at 100% -260px, rgba(248,113,113,.2) 0%, transparent 60%),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .shell{
      width:100%;
      max-width:420px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      border:1px solid var(--br);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card-head{
      padding:18px 20px 14px;
      background:linear-gradient(135deg,#ef4444,#b91c1c);
      color:#fff;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:42px;height:42px;border-radius:16px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.55);
      font-size:22px;
      box-shadow:0 10px 26px rgba(15,23,42,.45);
    }
    .title-wrap{
      text-align:left;
    }
    .title{
      font-weight:800;
      font-size:1.1rem;
      letter-spacing:.02em;
    }
    .subtitle{
      font-size:.86rem;
      color:#fee2e2;
    }
    .card-body{
      padding:18px 20px 20px;
    }

    /* Status + message */
    #status{
      font-size:.8rem;
      color:var(--muted);
      margin:0 0 8px;
      text-align:left;
      display:flex;
      align-items:center;
      gap:6px;
    }
    #status span.dot{
      width:10px;height:10px;border-radius:50%;
      background:#fbbf24;
      flex-shrink:0;
    }
    #status.ready span.dot{ background:var(--good); }
    #status.error span.dot{ background:var(--bad); }

    #message{
      margin-top:10px;
      font-size:.86rem;
      text-align:left;
      min-height:1.1em;
    }
    #message.ok{ color:var(--good); }
    #message.err{ color:var(--bad); }

    /* Form */
    .field{
      text-align:left;
      margin-top:10px;
    }
    .label{
      font-size:.82rem;
      font-weight:600;
      color:var(--muted);
      margin-bottom:4px;
      display:block;
    }
    .input{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--br);
      font-size:.95rem;
      outline:none;
      background:#fff;
      transition:border-color .16s, box-shadow .16s, background .16s;
    }
    .input:focus{
      border-color:#fecaca;
      box-shadow:0 0 0 3px rgba(248,113,113,.18);
      background:#fff7f7;
    }

    .hint{
      font-size:.8rem;
      color:var(--muted);
      margin-top:4px;
    }

    .btn{
      margin-top:16px;
      width:100%;
      padding:11px 14px;
      border-radius:14px;
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
      font-weight:700;
      font-size:.98rem;
      cursor:pointer;
      box-shadow:0 10px 26px rgba(185,28,28,.38);
      transition:background .18s, transform .08s, box-shadow .18s, opacity .12s;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn:hover{ background:#991b1b; transform:translateY(-1px); }
    .btn:active{ transform:translateY(0); box-shadow:0 4px 14px rgba(15,23,42,.4); }
    .btn:disabled{
      opacity:.6;
      cursor:default;
      transform:none;
      box-shadow:0 4px 14px rgba(15,23,42,.12);
    }

    .footer{
      margin-top:8px;
      font-size:.8rem;
      color:var(--muted);
      text-align:center;
    }
    .footer a{
      color:var(--accent);
      text-decoration:none;
      font-weight:600;
    }
    .footer a:hover{
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-head">
        <div class="logo">ðŸŽ®</div>
        <div class="title-wrap">
          <div class="title">Create Your Account</div>
          <div class="subtitle">One login for all your Game Hub lobbies.</div>
        </div>
      </div>
      <div class="card-body">
        <p id="status">
          <span class="dot"></span>
          <span>Connecting to serverâ€¦</span>
        </p>

        <div class="field">
          <label class="label" for="username">Username</label>
          <input id="username" class="input" type="text" autocomplete="off" placeholder="e.g. KnightCommander" />
        </div>

        <div class="field">
          <label class="label" for="password">Password</label>
          <input id="password" class="input" type="password" autocomplete="new-password" placeholder="Choose a password" />
        </div>

        <div class="field">
          <label class="label" for="confirm">Confirm Password</label>
          <input id="confirm" class="input" type="password" autocomplete="new-password" placeholder="Repeat your password" />
          <div class="hint">Note: stored in plain text to match your existing lobby login.</div>
        </div>

        <button id="createBtn" class="btn" disabled>
          <span>âœ… Create Account</span>
        </button>

        <p id="message"></p>

        <div class="footer">
          Already have an account? Just log in from the Game Hub lobby screen.
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import {
      getAuth,
      signInAnonymously,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ---------- FIREBASE SETUP ----------
    const firebaseConfig = {
      apiKey: "AIzaSyB7twY7z31ucB6pGA8JC_HrVMZhA8lNaJA",
      authDomain: "bible-game-246c0.firebaseapp.com",
      projectId: "bible-game-246c0",
      storageBucket: "bible-game-246c0.appspot.com",
      messagingSenderId: "959619818996",
      appId: "1:959619818996:web:5a9fbf492e23c765e445a1"
    };

    const app  = initializeApp(firebaseConfig);
    const db   = getFirestore(app);
    const auth = getAuth(app);

    let authReady = false;

    // DOM refs
    const statusEl  = document.getElementById("status");
    const statusDot = statusEl.querySelector(".dot");
    const statusText= statusEl.querySelector("span:last-child");
    const messageEl = document.getElementById("message");
    const btnEl     = document.getElementById("createBtn");
    const userEl    = document.getElementById("username");
    const passEl    = document.getElementById("password");
    const confEl    = document.getElementById("confirm");

    function setStatus(state, text){
      statusEl.classList.remove("ready","error");
      if (state === "ready") statusEl.classList.add("ready");
      if (state === "error") statusEl.classList.add("error");
      statusText.textContent = text;
    }

    function setMessage(text, type){
      messageEl.textContent = text || "";
      messageEl.classList.remove("ok","err");
      if (!text) return;
      if (type === "ok") messageEl.classList.add("ok");
      if (type === "err") messageEl.classList.add("err");
    }

    // Anonymous auth so rules with request.auth != null pass
    signInAnonymously(auth).catch(err => {
      console.error("Anon sign-in failed:", err);
      authReady = false;
      btnEl.disabled = true;
      setStatus("error","Sign-in failed. Refresh the page.");
    });

    onAuthStateChanged(auth, user => {
      if (!user) {
        authReady = false;
        btnEl.disabled = true;
        setStatus("error","Not signed in. Refresh the page.");
        return;
      }
      authReady = true;
      btnEl.disabled = false;
      setStatus("ready","Connected. You can create an account.");
    });

    // ---------- ACCOUNT CREATION ----------
    async function handleCreate(){
      setMessage("");
      if (!authReady || !auth.currentUser) {
        setMessage("â³ Still connecting. Please wait a moment.", "err");
        return;
      }

      const username = userEl.value.trim();
      const password = passEl.value;
      const confirm  = confEl.value;

      if (!username || !password || !confirm){
        setMessage("âš ï¸ Please fill in all fields.", "err");
        return;
      }
      if (password !== confirm){
        setMessage("âŒ Passwords do not match.", "err");
        return;
      }

      btnEl.disabled = true;
      btnEl.textContent = "Creatingâ€¦";

      try {
        const userRef = doc(db, "users", username);
        const existing = await getDoc(userRef);
        if (existing.exists()) {
          setMessage("âŒ Username already exists.", "err");
          btnEl.disabled = false;
          btnEl.textContent = "âœ… Create Account";
          return;
        }

        await setDoc(userRef, {
          username: username,
          password: password,       // kept plain to match existing login logic
          wins: 0,
          lastLogin: serverTimestamp()
        });

        setMessage(`âœ… Account "${username}" created!`, "ok");
        userEl.value = "";
        passEl.value = "";
        confEl.value = "";
      } catch (e) {
        console.error("Error creating account:", e);
        setMessage("âŒ Error creating account. Try again.", "err");
      } finally {
        btnEl.disabled = false;
        btnEl.textContent = "âœ… Create Account";
      }
    }

    btnEl.addEventListener("click", handleCreate);

    // Enter key convenience
    [userEl, passEl, confEl].forEach(el => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          handleCreate();
        }
      });
    });
  </script>
</body>
</html>


